## SQL查询当Cube构建任务完成，系统一般会自动把Cube的状态切换为就绪（Ready）。我们以KAP样例数据为例介绍SQL查询方式。首先切换到Insight页面，在Web UI上选择本案例所用的Kylin_Sample_1项目。然后根据Cube上维度和度量的设计，在查询输入框中输入SQL语句，然后单击Submit按钮。下面给出一下SQL查询的例子和相应的结果介绍。#### 单表行数统计````SELECT COUNT(*) FROM KYLIN_SALES````这条SQL用于查询KYLIN_SALES表中总行数，读者可以同时在Hive中执行同样的查询进行性能对比。在笔者的对比中，Hive查询耗时29.385秒，KAP查询耗时0.18秒。#### 多表连接````SELECTKYLIN_SALES.PART_DT,KYLIN_SALES.LEAF_CATEG_ID,KYLIN_SALES.LSTG_SITE_ID,KYLIN_CATEGORY_GROUPINGS.META_CATEG_NAME,KYLIN_CATEGORY_GROUPINGS.CATEG_LVL2_NAME,KYLIN_CATEGORY_GROUPINGS.CATEG_LVL3_NAME,KYLIN_SALES.LSTG_FORMAT_NAME,SUM(KYLIN_SALES.PRICE),COUNT(DISTINCT KYLIN_SALES.SELLER_ID)FROM KYLIN_SALES as KYLIN_SALES INNER JOIN KYLIN_CAL_DT as KYLIN_CAL_DTON KYLIN_SALES.PART_DT = KYLIN_CAL_DT.CAL_DTINNER JOIN KYLIN_CATEGORY_GROUPINGS as KYLIN_CATEGORY_GROUPINGSON KYLIN_SALES.LEAF_CATEG_ID = KYLIN_CATEGORY_GROUPINGS.LEAF_CATEG_ID AND KYLIN_SALES.LSTG_SITE_ID = KYLIN_CATEGORY_GROUPINGS.SITE_IDGROUP BY KYLIN_SALES.PART_DT,KYLIN_SALES.LEAF_CATEG_ID,KYLIN_SALES.LSTG_SITE_ID,KYLIN_CATEGORY_GROUPINGS.META_CATEG_NAME,KYLIN_CATEGORY_GROUPINGS.CATEG_LVL2_NAME,KYLIN_CATEGORY_GROUPINGS.CATEG_LVL3_NAME,KYLIN_SALES.LSTG_FORMAT_NAME````这条SQL将事实表KYLIN_SALES和两张维表根据外键进行了内部连接。在笔者的对比试验中，Hive查询耗时34.361秒，KAP查询耗时0.33秒。#### 维度列COUNT_DISTINCT````SELECTCOUNT(DISTINCT KYLIN_SALES.PART_DT)FROM KYLIN_SALES as KYLIN_SALES INNER JOIN KYLIN_CAL_DT as KYLIN_CAL_DTON KYLIN_SALES.PART_DT = KYLIN_CAL_DT.CAL_DTINNER JOIN KYLIN_CATEGORY_GROUPINGS as KYLIN_CATEGORY_GROUPINGSON KYLIN_SALES.LEAF_CATEG_ID = KYLIN_CATEGORY_GROUPINGS.LEAF_CATEG_ID AND KYLIN_SALES.LSTG_SITE_ID = KYLIN_CATEGORY_GROUPINGS.SITE_ID````这条SQL对PART_DT字段进行了COUNT_DISTINCT查询，但是该字段并没有被添加为COUNT_DISTINCT的度量。这个功能是从1.5.2版本开始支持的，即对于未定义的维度列，可以执行COUNT_DISTINCT的查询。在笔者的对比试验中，Hive查询耗时44.911秒，KAP查询耗时0.12秒。#### 全表查询````SELECT * FROM KYLIN_SALES````默认的，KAP并不对原始数据的明细进行保存，因此并不支持形如`SELECT *`的SQL查询。但是，用户经常希望通过执行`SELECT *`获取部分样例数据；因此KAP对这种SQL会返回不精确的查询结果。如果用户希望KAP支持原始数据的保存和查询，可以在Cube中定义RAW类型的度量。